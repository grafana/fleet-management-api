syntax = "proto3";

package validation.v1;

option go_package = "github.com/grafana/fleet-management-api/api/gen/proto/go/validation/v1;validationv1";

message ValidateRequest {
  // (required) The configuration contents to validate.
  string contents = 1;
  
  // Whether to validate against all supported versions instead of just the latest.
  bool validate_all_versions = 2;
}

message ValidateResponse {
  // Overall validation success across all tested versions.
  bool success = 1;
  
  // Validation results per version. The array lists validated versions in
  // decreasing semver order.
  repeated Version results = 2;
}

message Version {
  // The Alloy version this result applies to.
  string version = 1;
  
  // Whether validation succeeded for this version.
  bool success = 2;
  
  // Validation errors (only present if success = false).
  repeated Error errors = 3;
}

// Error represents a single validation error.
message Error {
  // Human-readable error message.
  string message = 1;
  
  // Location information (if available).
  optional Location location = 2;
}

// Location represents a position in the configuration file.
message Location {
  // Line number (1-based).
  int32 line = 1;
  
  // Column number (1-based).
  int32 column = 2;
  
  // The problematic text snippet for context.
  optional string snippet = 3;

  // End line number for multi-line issues (1-based).
  optional int32 end_line = 4;

  // End column number for multi-line issues (1-based).
  optional int32 end_column = 5;
}

// ValidationService provides configuration validation for Grafana Alloy.
service ValidationService {
  // Validate validates configuration contents against one or more Alloy versions.
  rpc Validate(ValidateRequest) returns (ValidateResponse) {
    option idempotency_level = NO_SIDE_EFFECTS;
  }
}

